(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{230:(e,t,n)=>{Promise.resolve().then(n.bind(n,7684))},542:()=>{},7684:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var r=n(5155),s=n(2115),a=n(1935);n(6368);var l=n(4787);let o=()=>{let[e,t]=(0,s.useState)({width:0,height:0}),[n,r]=(0,s.useState)(null),a=(0,s.useCallback)(e=>{null!==e&&r(e)},[]);return(0,s.useEffect)(()=>{if(!n)return;(()=>{let{width:e,height:r}=n.getBoundingClientRect();t({width:e,height:r})})();let e=new ResizeObserver(e=>{for(let n of e){let{width:e,height:r}=n.contentRect;t({width:e,height:r})}});return e.observe(n),()=>{e.disconnect()}},[n]),[a,e]},i=()=>{let[e,t]=(0,s.useState)({width:0,height:0}),[n,r]=(0,s.useState)(null),[a,l]=(0,s.useState)({width:0,height:0}),o=(0,s.useCallback)(e=>{null!==e&&r(e)},[]);return(0,s.useEffect)(()=>{let e=()=>{l({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,s.useEffect)(()=>{if(!n)return;(()=>{let{width:e,height:r}=n.getBoundingClientRect();t({width:e,height:r})})();let e=new ResizeObserver(e=>{for(let n of e){let{width:e,height:r}=n.contentRect;t({width:e,height:r})}});return e.observe(n),()=>{e.disconnect()}},[n]),(0,s.useEffect)(()=>{if(!n||0===e.width||0===e.height)return;let t=a.width-320,r=a.height/e.height,s=e.width*r;s>t?(n.style.width="100%",n.style.marginLeft="auto",n.style.marginRight="auto"):n.style.width="".concat(s,"px")},[a,e]),[o,e]};var c=n(2651);let d=(e,t,n)=>{let[r,a]=(0,s.useState)({data:null,loading:!0,error:null}),l=async()=>{if(e)try{a(e=>({...e,loading:!0}));let r={action:"load",id:t,type:n};console.log(r.type);let{data:s}=await (0,c.A)({method:"post",url:e,data:r,headers:{"Content-Type":"application/json"}});a({data:s,loading:!1,error:null}),console.log(s)}catch(e){a({data:null,loading:!1,error:e})}finally{a(e=>({...e,loading:!1}))}};return(0,s.useEffect)(()=>{l()},[e]),{...r,handleFetch:l}},u=(e,t,n)=>{let[r,a]=(0,s.useState)({data:null,loading:!0,error:null,success:!1});return[async r=>{if(e)try{a(e=>({...e,loading:!0,success:!1})),r.id=t,n?r.type=n:r.type="",console.log(r.type),console.log(r);let{data:s}=await (0,c.A)({method:"post",url:e,data:r,headers:{"Content-Type":"application/json"}});a({data:s,loading:!1,error:null,success:!0})}catch(e){throw Error("Error en post")}finally{a(e=>({...e,loading:!1}))}},{...r}]},m={no_status:{label:"No Status",color:"gray",bgColor:"bg-gray-500/50",textColor:"text-gray-200"},in_progress:{label:"In Progress",color:"blue",bgColor:"bg-blue-500/50",textColor:"text-blue-200"},needs_review:{label:"Needs Review",color:"orange",bgColor:"bg-orange-500/50",textColor:"text-orange-200"},approved:{label:"Approved",color:"green",bgColor:"bg-green-500/50",textColor:"text-green-200"}},h=e=>{let{active:t,message:n,setStateMessage:a}=e;return(0,s.useEffect)(()=>{let e;return t&&(e=setTimeout(()=>{a({show:!1,message:""})},5e3)),()=>{e&&clearTimeout(e)}},[t,a]),(0,r.jsxs)("div",{className:"\n            fixed bottom-4 left-1/2 -translate-x-1/2 \n            transform transition-all duration-300 ease-in-out\n            ".concat(t?"translate-y-0 opacity-100":"translate-y-20 opacity-0 pointer-events-none","\n            z-50 min-w-[300px] max-w-md\n        "),children:[(0,r.jsxs)("div",{className:"bg-red-500/90 backdrop-blur-sm text-white px-6 py-4 rounded-lg shadow-lg  flex items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 7.85786 16.1421 4.5 12 4.5ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z",fill:"currentColor"}),(0,r.jsx)("path",{d:"M12 7.5C12.4142 7.5 12.75 7.83579 12.75 8.25V12.75C12.75 13.1642 12.4142 13.5 12 13.5C11.5858 13.5 11.25 13.1642 11.25 12.75V8.25C11.25 7.83579 11.5858 7.5 12 7.5Z",fill:"currentColor"}),(0,r.jsx)("path",{d:"M12 16.5C12.4142 16.5 12.75 16.1642 12.75 15.75C12.75 15.3358 12.4142 15 12 15C11.5858 15 11.25 15.3358 11.25 15.75C11.25 16.1642 11.5858 16.5 12 16.5Z",fill:"currentColor"})]})}),(0,r.jsx)("p",{className:"text-sm font-medium",children:n})]}),(0,r.jsx)("button",{onClick:()=>a({show:!1,message:""}),className:"flex-shrink-0 hover:bg-white/20 rounded-lg p-1.5 transition-colors duration-200",children:(0,r.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M6.75 6.75L17.25 17.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M17.25 6.75L6.75 17.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-white/20 rounded-b-lg overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-white/40 transition-all duration-[5000ms] ease-linear",style:{width:t?"0%":"100%",transitionProperty:"width"}})})]})},g=e=>{let{isImage:t,imageRef:n,comments:a,playerRef:l,fabricCanvasRef:o,canva:i,dimensions:c,setIsDrawingMode:d,updateHandlerRef:m,queryParams:h,toggleDrawingMode:g,setComments:p,isDrawingMode:x,data:w,clearCanvas:v,handleFetch:f,setVideoStatus:y,successPostVideoStatus:b,setStateMessage:j,dataComments:C,setDataComments:k,optimisticComments:N,setOptimisticComments:S,lastUpdatedComments:E,setLastUpdatedComments:D}=e,[M,R]=(0,s.useState)(null),[O,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{k(a)},[a]);let q=(0,s.useRef)(C);(0,s.useEffect)(()=>{D(a)},[]);let[z,L]=(0,s.useTransition)(),W=e=>{let[t,n,r]=A(e.timestamp).split(":");R({...e,editText:e.text,hours:t,minutes:n,seconds:r})},T=(e,t)=>{R(n=>({...n,[e]:t}))},B=(e,t)=>{"Enter"===e.key&&t()},H=async e=>{console.log("Usando lastUpdatedComments");let t=E.map(t=>t.id===e?{...t,commentDone:!t.commentDone}:t);console.log("Estado de commentDone:",O),D(t),_(!1);let n={action:"save",lastUpdated:Date.now(),comments:t};_(!1),L(async()=>{try{D(t),S({type:"check",updatedComments:t}),await V(n),k(t),p(t),_(!0)}catch(e){console.error("Error updating comments:",e),j({show:!0,message:"Error checking/unchecking comment"})}})},A=e=>{let t=new Date(0);return t.setSeconds(e),t.toISOString().substring(11,19)},I=(e,t,n)=>3600*e+60*t+n,P=(e,t,n,r)=>{if(l.current){if(l.current.currentTime(e),o.current&&t){let s=document.querySelector(".canvas-container");l.current.el();let a=document.querySelector(".canvi"),u=document.querySelector(".upper-canvas");s&&(s.style.display="block",s.style.pointerEvents="none"),a&&u&&(a.style.pointerEvents="none",u.style.pointerEvents="none"),d(!1),o.current.clear(),i.loadFromJSON(t);let h=!1,g=()=>{if(.1>Math.abs(l.current.currentTime()-e)){if(s&&(s.style.display="block"),i&&!h){let e=c.width/n,t=c.height/r;i.getObjects().forEach(n=>{let r=n.strokeWidth;n.left=n.left*e,n.top=n.top*t,n.scaleX=n.scaleX*e,n.scaleY=n.scaleY*t,n.strokeWidth=r/((e+t)/2),n.setCoords()}),i.renderAll(),h=!0}}else s&&(s.style.display="none")};m.current&&l.current.off("timeupdate",m.current),l.current.on("timeupdate",g),m.current=g,l.current.pause()}else{var s;null===(s=o.current)||void 0===s||s.clear()}}},U=(e,t,n,r)=>{let s=document.querySelector(".canvas-container"),a=document.querySelector(".canvi"),l=document.querySelector(".upper-canvas");s&&(s.style.display="block",s.style.pointerEvents="none"),a&&l&&(a.style.pointerEvents="none",l.style.pointerEvents="none"),d(!1);let o=c.width/n,u=c.height/r;i.clear();let m=JSON.parse(JSON.stringify(t));m.objects.forEach(e=>{let t=e.strokeWidth;e.left=e.left*o,e.top=e.top*u,e.scaleX=e.scaleX*o,e.scaleY=e.scaleY*u,e.strokeWidth=t/((o+u)/2)}),i.loadFromJSON(m,()=>{})},F=async()=>{if(!M)return;let e=o.current?o.current.toJSON():null,t=parseInt(M.hours)||0,n=parseInt(M.minutes)||0,r=parseInt(M.seconds)||0,s=I(t=Math.min(Math.max(t,0),23),n=Math.min(Math.max(n,0),59),r=Math.min(Math.max(r,0),59)),a=Date.now(),l={...M,id:a,text:M.editText,timestamp:s,formattedTime:A(s),drawing:e,canvasWidth:c.width,canvasHeight:c.height};try{let e=E.map(e=>e.id===M.id?l:e),t={action:"save",lastUpdated:Date.now(),comments:e};q.current=C,D(e),L(async()=>{try{x&&g(),D(e),S({type:"update",updatedComments:e}),await V(t),k(e),p(e),R(null)}catch(e){console.error("Error updating comments:",e),j({show:!0,message:"Error updating comment"})}})}catch(e){console.error("Error updating comments:",e)}},J=async()=>{if(!M)return;x&&g();let e=a.filter(e=>e.id!==M.id),t={action:"save",lastUpdated:Date.now(),comments:e};q.current=C,L(async()=>{try{S({type:"delete",updatedComments:e}),await V(t),k(e),D(e)}catch(e){k(q.current),S(),j({show:!0,message:"Error deleting comment"})}}),v(),p(e),R(null)},[V,{data:X,loading:Y,error:Z,success:K}]=u(h.webhook_url,h.id,h.type);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-center gap-2 mb-4",children:(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-200 py-2",children:"Comments"})}),(0,r.jsx)("div",{className:"flex-grow overflow-y-auto space-y-2 text-sm scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent",children:(null==N?void 0:N.length)>0?N.map(e=>M&&M.id===e.id?(0,r.jsxs)("div",{className:"p-2.5 bg-gray-700/50 backdrop-blur-sm rounded-lg",children:[!t&&(0,r.jsxs)("div",{className:"flex gap-1 mb-2",children:[(0,r.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:M.hours,onChange:e=>T("hours",e.target.value)}),":",(0,r.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:M.minutes,onChange:e=>T("minutes",e.target.value)}),":",(0,r.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:M.seconds,onChange:e=>T("seconds",e.target.value)})]}),(0,r.jsx)("input",{type:"text",className:"border border-gray-400 p-2 w-full text-white",value:M.editText,onChange:e=>R({...M,editText:e.target.value}),onKeyPress:e=>B(e,F)}),(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)("button",{className:"bg-green-500 text-white px-4 py-1",onClick:F,children:"Save"}),(0,r.jsx)("button",{className:"bg-gray-500 text-white px-4 py-1",onClick:()=>{R(null),x&&g()},children:"Cancel"}),(0,r.jsx)("button",{className:"bg-red-500 text-white px-4 py-1",onClick:J,children:"Delete"})]})]},e.id):(0,r.jsxs)("div",{className:"p-2.5 bg-gray-700/50 backdrop-blur-sm rounded-lg hover:bg-gray-600/50 transition-all duration-200",onClick:()=>t?U(e.timestamp,e.drawing,e.canvasWidth,e.canvasHeight):P(e.timestamp,e.drawing,e.canvasWidth,e.canvasHeight),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("button",{onClick:()=>H(e.id),className:"relative w-4 h-4 flex items-center justify-center",children:(0,r.jsx)("div",{className:"\n                                w-4 h-4 border-2 rounded \n                                transition-all duration-200 ease-in-out\n                                ".concat(e.commentDone?"border-green-500 bg-green-500":"border-gray-400 bg-transparent","\n                              "),children:e.commentDone&&(0,r.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),!t&&(0,r.jsx)("span",{className:"text-blue-400 cursor-pointer hover:text-blue-300 text-xs ".concat(e.commentDone?"line-through text-gray-400":""),onClick:()=>P(e.timestamp,e.drawing,e.canvasWidth,e.canvasHeight),children:null==e?void 0:e.formattedTime})]}),(0,r.jsx)("button",{className:"text-gray-400 hover:text-white transition-colors duration-200 text-xs",onClick:()=>W(e),children:"✏️"})]}),(0,r.jsx)("div",{className:"text-gray-200 break-words text-xs pl-6 ".concat(e.commentDone?"line-through text-gray-400":""),children:e.text})]},e.id)):(0,r.jsx)("p",{className:"text-gray-400 text-center py-4 text-xs",children:"No comments yet"})})]})},p=e=>{let{isVideoLoaded:t,playerRef:n,fabricCanvasRef:a,dimensions:l,setComments:o,comments:i,clearCanvas:c,isDrawingMode:d,toggleDrawingMode:m,queryParams:h,setStateMessage:g,dataComments:p,setDataComments:x,optimisticComments:w,setOptimisticComments:v,canva:f,isImage:y,setIsDrawingMode:b,lastUpdatedComments:j,setLastUpdatedComments:C}=e,[k,N]=(0,s.useState)(""),S=(0,s.useRef)(null),[E,D]=(0,s.useTransition)(),[M,{data:R,loading:O,error:_,success:q}]=u(h.webhook_url,h.id,h.type),z=async()=>{let e;let t=a.current?a.current.toJSON():null;if(0===t.objects.length&&""===k)return;e=t.objects.length>0&&""===k?"*drawing only*":k;let r={id:Date.now(),text:e,timestamp:y?null:n.current.currentTime(),formattedTime:y?null:(e=>{let t=new Date(0);return t.setSeconds(e),t.toISOString().substring(11,19)})(n.current.currentTime()),drawing:t,canvasWidth:l.width,canvasHeight:l.height,commentDone:!1},s={action:"save",lastUpdated:Date.now(),comments:[...i,r]};N(""),b(!1),C(s.comments),D(async()=>{try{!y&&s.comments&&Array.isArray(s.comments)&&s.comments.sort((e,t)=>null===e.timestamp?1:null===t.timestamp?-1:e.timestamp-t.timestamp),v({type:"add",updatedComments:s.comments});let e=document.querySelector(".canvas-container");e&&(e.style.display="none");let t=document.querySelector(".canvi");t&&(t.style.pointerEvents="none");let r=document.querySelector(".upper-canvas");r&&(r.style.pointerEvents="none"),y||n.current.controls(!0),f.clear(),C(s.comments),await M(s),x(s.comments),o(s.comments)}catch(a){console.error("Error adding comment:",a),g({show:!0,message:"Error adding comment"}),N(s.comments[s.comments.length-1].text);let e=document.querySelector(".canvas-container");e&&(e.style.display="block");let t=document.querySelector(".canvi");t&&(t.style.pointerEvents="auto");let n=document.querySelector(".upper-canvas");n&&(n.style.pointerEvents="auto"),f.clear();let r=JSON.parse(JSON.stringify(s.comments[s.comments.length-1].drawing));f.loadFromJSON(r),b(!0)}}),S.current&&(S.current.style.height="auto")};return(0,r.jsx)("div",{children:t&&(0,r.jsx)("div",{className:"  mt-4 w-full flex justify-center",children:(0,r.jsxs)("div",{className:"relative w-[600px] max-w-full",children:[(0,r.jsx)("textarea",{ref:S,className:"w-full bg-gray-800/50 backdrop-blur-sm text-white px-4 py-3 pr-40 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none min-h-[44px] max-h-[200px] resize-y md:text-sm text-base shadow-lg",value:k,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},placeholder:"Add a comment...",style:{overflow:"hidden",lineHeight:"1.5",fontSize:"14px",WebkitTextSizeAdjust:"100%"},onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}}),(0,r.jsxs)("div",{className:"absolute right-2 top-2 flex gap-2",children:[(0,r.jsx)("button",{className:"p-1.5 rounded-md transition-all duration-200 ".concat(d?"bg-red-500 hover:bg-red-600":"bg-gray-600 hover:bg-gray-500"),onClick:()=>m(),title:d?"Stop Drawing":"Start Drawing",children:d?(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 002 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),(0,r.jsx)("path",{fillRule:"evenodd",d:"M12 7a1 1 0 00-1 1v4a1 1 0 002 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})]}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M13.293 3.293a1 1 0 011.414 0l2 2a1 1 0 010 1.414l-9 9a1 1 0 01-.39.242l-3 1a1 1 0 01-1.266-1.265l1-3a1 1 0 01.242-.391l9-9zM14 4l2 2-9 9-3 1 1-3 9-9z",clipRule:"evenodd"})})}),(0,r.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md transition-all duration-200 text-sm",onClick:z,children:"Add"})]})]})})})},x=()=>{var e,t;let[n,c]=(0,s.useState)({show:!1,message:"Hola muuundo"}),[x,w]=(0,s.useState)(""),[v,f]=(0,s.useState)([]),[y,b]=(0,s.useState)(!0),[j,C]=(0,s.useState)([]),[k,N]=(0,s.useState)(!1),[S,E]=(0,s.useState)(!1),[D,M]=(0,s.useState)(!1),[R,O]=(0,s.useState)([]);console.log(v);let[_,q]=(0,s.useState)(!1),z=(0,s.useRef)(null),L=(0,s.useRef)(null),W=(0,s.useRef)(null),T=(0,s.useRef)(null),B=(0,s.useRef)(null),H=(0,s.useRef)(()=>{}),[A,I]=(0,s.useState)(null),[P,U]=o(),[F,J]=i(),[V,X]=(0,s.useState)(()=>{{let e=new URLSearchParams(window.location.search);return{webhook_url:e.get("webhook_url"),id:e.get("id"),type:e.get("type")}}}),[Y,Z]=(0,s.useOptimistic)(j,(e,t)=>{switch(null==t?void 0:t.type){case"delete":case"update":case"check":case"add":return t.updatedComments;default:return e}}),[K,$]=(0,s.useState)("no_status"),G=(0,s.useRef)(K),[Q,ee]=(0,s.useOptimistic)(K,(e,t)=>(null==t?void 0:t.type)==="save"?t.status:e),[et,en]=(0,s.useTransition)(),{data:er,loading:es,error:ea,handleFetch:el}=d(V.webhook_url,V.id,V.type),[eo,{data:ei,loading:ec,error:ed,success:eu}]=u(V.webhook_url,V.id,V.type);(0,s.useEffect)(()=>{er&&y&&b(!1)},[er]),(0,s.useEffect)(()=>{er&&f(er.comments)},[er]),(0,s.useEffect)(()=>{if(T.current.width=U.width,T.current.height=U.height,er&&!ew(er.video_url)&&L.current&&!W.current){W.current=(0,a.A)(L.current,{controls:!0,fluid:!0,bigPlayButton:!1,userActions:{hotkeys:!0,doubleClick:!0}});let e=document.querySelector(".vjs-control-bar");e&&(e.style.display="flex");let t=W.current;t.on("play",()=>{if(B.current){B.current.clear();let e=document.querySelector(".canvas-container");e&&(e.style.display="none")}}),t.on("seeking",()=>{}),t.src({src:null==er?void 0:er.video_url,type:"video/mp4"}),N(!0);try{if(T.current&&!B.current){let e=new l.Hl(T.current);B.current=e,I(e),e.freeDrawingBrush=new l.mW(e),e.freeDrawingBrush.width=4,e.freeDrawingBrush.color="#ff0000",e.isDrawingMode=!1,W.current.on("loadedmetadata",()=>{let t=W.current.el();t&&e&&(e.setDimensions({width:t.offsetWidth,height:t.offsetHeight},{cssOnly:!1}),e.renderAll());let n=document.querySelector(".canvas-container");n&&(n.style.display="none")})}}catch(e){console.error("Fabric canvas initialization error:",e)}}},[er]),(0,s.useEffect)(()=>{if(er&&ew(er.video_url)&&(q(ew(er.video_url)),z.current))try{if(T.current&&!B.current){let e=new l.Hl(T.current);B.current=e,I(e),e.freeDrawingBrush=new l.mW(e),e.freeDrawingBrush.width=4,e.freeDrawingBrush.color="#ff0000",e.isDrawingMode=!1;let t=z.current;e.setDimensions({width:t.naturalWidth,height:t.naturalHeight},{cssOnly:!1});let n=document.querySelector(".canvas-container");n&&(n.style.display="none"),e.renderAll()}}catch(e){console.error("Fabric canvas initialization error:",e)}},[er,z.current]),(0,s.useEffect)(()=>{if(A){let e=A.width,t=A.height,n=U.width/e,r=U.height/t;A.setDimensions({width:U.width,height:U.height}),console.log(U.width),console.log(U.height),A.getObjects().forEach(e=>{let t=e.strokeWidth;e.left=e.left*n,e.top=e.top*r,e.scaleX=e.scaleX*n,e.scaleY=e.scaleY*r,e.strokeWidth=t/((n+r)/2),e.setCoords()}),A.renderAll()}},[U]);let em=()=>{B.current&&(E(!S),B.current.isDrawingMode=!S,B.current.clear());let e=document.querySelector(".canvas-container");e&&(e.style.display=S?"none":"block");let t=document.querySelector(".canvi");t&&(t.style.pointerEvents=S?"none":"auto");let n=document.querySelector(".upper-canvas");n&&(n.style.pointerEvents=S?"none":"auto"),_||(S||W.current.pause(),document.querySelector(".video-js"),S?W.current.controls(!0):W.current.controls(!1))},eh=()=>{B.current&&B.current.clear()},eg=async(e,t)=>{try{let n={action:"save",lastUpdated:Date.now(),status:e,comments:t};en(async()=>{try{G.current=K,ee({type:"save",status:e}),await eo(n),$(e)}catch(e){$(G.current),ee(),c({show:!0,message:"Error saving the state"})}}),console.log("Status actualizado:",e)}catch(e){console.error("Error al guardar el estado:",e)}};(0,s.useEffect)(()=>{let e=()=>{let e=new URLSearchParams(window.location.search);X({webhook_url:e.get("webhook_url"),id:e.get("id")})};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);let[ep,ex]=(0,s.useState)(!0);(0,s.useEffect)(()=>{er&&er.status&&($(er.status),N(!0))},[er]);let ew=e=>/\.(jpg|jpeg|png|gif|bmp|webp|svg)(\?.*)?$/i.test(e);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[(0,r.jsx)("div",{className:"flex-1 transition-all duration-300 ease-in-out \n          ".concat(ep?"lg:pr-80":"lg:pr-0","\n          ").concat(ep?"mb-[50vh]":"mb-0"," lg:mb-0\n        "),children:(0,r.jsxs)("div",{className:"container-principal w-[100%] flex flex-col justify-center ",ref:F,children:[(0,r.jsxs)("div",{className:"video-container relative w-full mt-4 ",ref:P,children:[_?(0,r.jsx)("img",{ref:z,src:er.video_url,style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):(0,r.jsx)("video",{ref:L,className:"video-js vjs-big-play-centered w-full vjs-big-play-button-hide",playsInline:!0,controls:!0}),(0,r.jsx)("canvas",{ref:T,className:"canvi absolute top-0 left-0 pointer-events-auto w-full h-full",style:{zIndex:1,width:"100%",height:"100%"}})]}),(0,r.jsx)(p,{setIsDrawingMode:E,isVideoLoaded:k,playerRef:W,fabricCanvasRef:B,dimensions:U,setComments:f,comments:v,handlePostComment:eo,clearCanvas:eh,isDrawingMode:S,toggleDrawingMode:em,queryParams:V,dataComments:j,setDataComments:C,setOptimisticComments:Z,setStateMessage:c,canva:A,isImage:_,lastUpdatedComments:R,setLastUpdatedComments:O})]})}),!ep&&(0,r.jsx)("button",{onClick:()=>ex(e=>!e),className:"fixed z-50 bg-gray-800/50 backdrop-blur-sm p-2 rounded-full hover:bg-gray-700/50 transition-all duration-200 right-4 bottom-4 lg:top-4 lg:bottom-auto",title:ep?"Hide Comments":"Show Comments",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),(0,r.jsx)("div",{className:"fixed transition-all duration-300 ease-in-out\n          lg:w-80 w-full h-[min(50vh,300px)] lg:h-screen\n          lg:right-0 right-0\n          lg:top-0 bottom-0\n          bg-gray-800/50 backdrop-blur-sm\n          ".concat(ep?"translate-y-0 lg:translate-x-0":"translate-y-full lg:translate-x-full","\n        "),children:k&&(0,r.jsxs)("div",{className:"h-full p-4 flex flex-col",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("label",{className:"text-sm font-medium text-gray-200",children:"Video Status"})}),(0,r.jsx)("div",{className:"flex justify-end items-center",children:(0,r.jsx)("a",{href:"https://www.skool.com/no-code-architects",target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer hover:opacity-80 transition-opacity",children:(0,r.jsx)("img",{src:"/logo.png",alt:"logo",className:"w-10 h-10"})})})]}),(0,r.jsx)("select",{value:Q,onChange:e=>{eg(e.target.value,v)},className:"w-full px-3 py-2 rounded-lg transition-colors duration-200 text-sm ".concat(null===(e=m[K])||void 0===e?void 0:e.bgColor," ").concat(null===(t=m[K])||void 0===t?void 0:t.textColor),style:{appearance:"none",backgroundImage:"url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1rem",paddingRight:"2.5rem"},children:Object.entries(m).map(e=>{let[t,{label:n,bgColor:s,textColor:a}]=e;return(0,r.jsx)("option",{value:t,className:"".concat(s," ").concat(a),style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n},t)})})]}),(0,r.jsx)(g,{comments:v,setComments:f,handlePostComment:eo,handleFetch:el,playerRef:W,fabricCanvasRef:B,canva:A,dimensions:U,setIsDrawingMode:E,updateHandlerRef:H,queryParams:V,toggleDrawingMode:em,isDrawingMode:S,data:er,clearCanvas:eh,setVideoStatus:$,setStateMessage:c,dataComments:j,setDataComments:C,optimisticComments:Y,setOptimisticComments:Z,imageRef:z,isImage:_,lastUpdatedComments:R,setLastUpdatedComments:O})]})})]}),y&&(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-900 z-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("img",{src:"/logo.png",alt:"logo",className:"w-20 h-20 animate-pulse"}),(0,r.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})]})}),(0,r.jsx)(h,{active:n.show,message:n.message,setStateMessage:c})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[953,776,742,821,441,587,358],()=>t(230)),_N_E=e.O()}]);